
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Sling - Internationalization Support</TITLE>
    <LINK rel="stylesheet" href="http://incubator.apache.org/sling/site/media.data/site.css" type="text/css" media="all">
    <LINK rel="icon" href="http://incubator.apache.org/sling/site/media.data/favicon.ico">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY><div class="siteconversion">This is an old version of the Sling website, see the <a href="http://sling.apache.org/site-conversion.html">site conversion page</a> for more info.</div>
    <DIV class="title">
      <DIV class="logo">
        <A href="http://incubator.apache.org/sling/site/index.html">
          <IMG border="0" alt="Apache Sling" src="http://incubator.apache.org/sling/site/media.data/logo.png">
        </A>
      </DIV>
      <DIV class="header">
        <A href="http://incubator.apache.org/">
          <IMG border="0" alt="Apache Incubator" src="http://incubator.apache.org/images/apache-incubator-logo.png">
        </A>
      </DIV>
    </DIV>
    <DIV class="menu">
                                    <P style="display: none"></P>

<UL>
	<LI><A href="documentation.html" title="Documentation">Documentation</A></LI>
	<LI><A href="advanced-topics.html" title="Advanced Topics">Advanced Topics</A></LI>
	<LI><A href="development.html" title="Development">Development</A></LI>
	<LI><SPAN class="nobr"><A href="http://incubator.apache.org/sling/site/downloads.cgi" title="Visit page outside Confluence" rel="nofollow">Downloads<SUP><IMG class="rendericon" src="http://cwiki.apache.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><A href="contributing.html" title="Contributing">Contributing</A></LI>
	<LI><A href="links.html" title="Links">Links</A></LI>
	<LI><SPAN class="nobr"><A href="http://cwiki.apache.org/SLING/faq.html" title="Visit page outside Confluence" rel="nofollow">FAQ<SUP><IMG class="rendericon" src="http://cwiki.apache.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://cwiki.apache.org/SLING/" title="Visit page outside Confluence" rel="nofollow">Wiki<SUP><IMG class="rendericon" src="http://cwiki.apache.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><A href="project-information.html" title="Project Information">Project Information</A></LI>
	<LI><SPAN class="nobr"><A href="http://incubator.apache.org/sling/apidocs/sling5/index.html" title="Visit page outside Confluence" rel="nofollow">Sling 5 API<SUP><IMG class="rendericon" src="http://cwiki.apache.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://www.apache.org/foundation/thanks.html" title="Visit page outside Confluence" rel="nofollow">Sponsors<SUP><IMG class="rendericon" src="http://cwiki.apache.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://www.apache.org/foundation/sponsorship.html" title="Visit page outside Confluence" rel="nofollow">Sponsorship<SUP><IMG class="rendericon" src="http://cwiki.apache.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN>

<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px"></P>
</LI>
</UL>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </DIV>
    <DIV class="main">
        <DIV class="breadcrump" style="font-size: 80%;">
<A href="apache-sling.html" title="Apache Sling Website">Apache Sling Website</A>&nbsp;&gt;&nbsp;<A href="apache-sling.html" title="Apache Sling">Apache Sling</A>&nbsp;&gt;&nbsp;<A href="advanced-topics.html" title="Advanced Topics">Advanced Topics</A>&nbsp;&gt;&nbsp;<A href="" title="Internationalization Support">Internationalization Support</A>
        </DIV>
<H1><A name="InternationalizationSupport-InternationalizationSupport"></A>Internationalization Support</H1>

<P>Internationalization support in Sling consists of four methods in the <TT>SlingHttpServletRequest</TT> interface:</P>

<UL>
	<LI><TT>getLocale()</TT> &ndash; Returns the primary <TT>Locale</TT> for the current request. This method is inherited from the <TT>javax.servlet.ServletRequest</TT> interface.</LI>
	<LI><TT>getLocales()</TT> &ndash; Returns the <TT>Locale</TT> instances for the current request. This method is inherited from the <TT>javax.servlet.ServletRequest</TT> interface.</LI>
	<LI><TT>getResourceBundle(Locale)</TT> &ndash; Returns a <TT>ResourceBundle</TT> for the given <TT>Locale</TT>. This method is specific to Sling.</LI>
	<LI><TT>getResourceBundle(String, Locale)</TT> &ndash; Returns a <TT>ResourceBundle</TT> of a given base name for the given <TT>Locale</TT>. This method is specific to Sling.</LI>
</UL>



<P>These methods have a default implementation in the <TT>org.apache.sling.core</TT> bundle and an extended and extensible implementation in the <TT>org.apache.sling.i18n</TT> bundle.</P>


<H2><A name="InternationalizationSupport-DefaultImplementationinthe%7B%7Borg.apache.sling.core%7D%7DBundle"></A>Default Implementation in the <TT>org.apache.sling.core</TT> Bundle</H2>

<P>The default implementation of the above mentioned four methods in the sling.core bundle is contained in the bundle-private class <TT>org.apache.sling.impl.SlingHttpServletRequestImpl</TT> which is the primary implementation of the <TT>SlingHttpServletRequest</TT> interface:</P>

<UL>
	<LI><TT>getLocale()</TT> &ndash; Returns the <TT>Locale</TT> from the request object of the servlet container in which Sling is running. As per the Servlet API specification, this is either the primary Locale of the <TT>Accept-Language</TT> request header or the server default locale.</LI>
	<LI><TT>getLocales()</TT> &ndash; Returns the <TT>Enumeration</TT> from the request object of the servlet container in which Sling is running. As per the Servlet API specification, this is either based on the <TT>Accept-Language</TT> request header or just the server default locale.</LI>
	<LI><TT>getResourceBundle(Locale)</TT> &ndash; Returns a <TT>ResourceBundle</TT> whose <TT>getString(String key)</TT> method returns the <TT>key</TT> as the message and whose <TT>getKeys()</TT> method returns an empty <TT>Enumeration</TT>.</LI>
	<LI><TT>getResourceBundle(String, Locale)</TT> &ndash; Returns a <TT>ResourceBundle</TT> whose <TT>getString(String key)</TT> method returns the <TT>key</TT> as the message and whose <TT>getKeys()</TT> method returns an empty <TT>Enumeration</TT>.</LI>
</UL>



<P>NOTE: Unlike the default implementations of the <TT>ResourceBundle</TT> abstract class in the Java Runtime &ndash; <TT>PropertyResourceBundle</TT> and <TT>ListResourceBundle</TT> &ndash; the <TT>ResourceBundle</TT> returned by the default implementation of the <TT>getResourceBundle(Locale)</TT> and <TT>getResourceBundle(String, Locale)</TT> always returns a string message for any key, which is the key itself. This prevents throwing <TT>MissingResourceException</TT>.</P>



<H2><A name="InternationalizationSupport-ExtensibleImplementationinthe%7B%7Borg.apache.sling.i18n%7D%7DBundle"></A>Extensible Implementation in the <TT>org.apache.sling.i18n</TT> Bundle</H2>

<P>The <TT>org.apache.sling.i18n</TT> Bundle implements a request level <TT>Filter</TT> providing extensible implementations of the above mentioned three methods. Extensibility is attained by defining two service interfaces:</P>

<UL>
	<LI><TT>LocaleResolver</TT> &ndash; The <TT>LocaleResolver</TT> interface defines a method which may be implemented by a service outside of the sling.i18n bundle. If no such service is registered the default behaviour is as described above for the sling.core bundle. The service described by this interface is used to implement the <TT>getLocale()</TT> and <TT>getLocales()</TT> method.</LI>
</UL>


<UL>
	<LI><TT>ResourceBundleProvider</TT> &ndash; The <TT>ResourceBundleProvider</TT> interface defines two methods to acquire a <TT>ResourceBundle</TT> for any <TT>Locale</TT> and an optional base name. This service interface is not intended to be implemented outside of the sling.i18n bundle: A JCR Repository based implementation is contained in the sling.i18n bundle. The <TT>ResourceBundleProvider</TT> service is not only used within the sling.i18n bundle to implement the <TT>SlingHttpServletRequest.getResourceBundle(Locale)</TT> and  <TT>SlingHttpServletRequest.getResourceBundle(String, Locale)</TT> methods. The service may also be used by Sling applications to acquire <TT>ResourceBundle</TT> instances without having a request object by getting the service and calling its <TT>getResourceBundle(Locale)</TT> or <TT>getResourceBundle(String, Locale)</TT> method directly.</LI>
</UL>




<H3><A name="InternationalizationSupport-JCRRepositorybased%7B%7BResourceBundleProvider%7D%7D"></A>JCR Repository based <TT>ResourceBundleProvider</TT></H3>

<P>The sling.i18n Bundle provides the implementation of the <TT>ResourceBundleProvider</TT> interface, which may also be used outside of Sling requests for service tasks. This implementation gets the messages from a JCR Repository stored below nodes of the mixin node type <TT>mix:language</TT> or <TT>sling:Language</TT>. These language nodes have a <TT>jcr:language</TT> property naming the language of the resources. In the context of the JCR based <TT>ResourceBundleProvider</TT> this is of course expected to be the string value of respective <TT>Locale</TT>.</P>

<P>The (direct) child nodes of the <TT>mix:language</TT> node must contain two special properties naming the key string and the message:</P>

<UL>
	<LI><TT>sling:key</TT> &ndash; The <TT>sling:key</TT> property is a string property being the key for which the node contains the message(s).</LI>
	<LI><TT>sling:message</TT> &ndash; The <TT>sling:message</TT> property represents the resource for the key.</LI>
</UL>


<P>The exact location of these nodes is not relevant as the <TT>ResourceBundleProvider</TT> finds them by applying a JCR search. It is only required that the message nodes are located below <TT>mix:language</TT> or <TT>sling:Language</TT> nodes. Such structures may also be scattered in the repository to allow storing message resources next to where they are most likely used, such as request scripts.</P>


<H3><A name="InternationalizationSupport-%7B%7BResourceBundle%7D%7Dwithbasenames"></A><TT>ResourceBundle</TT> with base names</H3>

<P>Similar to standard Java <TT>ResourceBundle</TT> instances, Sling <TT>ResourceBundle</TT> instances may be created for base names through any of the <TT>getResourceBundle(String, Locale)</TT> methods. These methods use the base name parameter as a selector for the values of the <TT>sling:basename</TT> property of the <TT>mix:language</TT> or <TT>sling:Language</TT> nodes.</P>

<P>The base name argument can take one three values:</P>

<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Value </TH>
<TH class="confluenceTh"> <TT>ResourceBundle</TT> selection </TH>
</TR>
<TR>
<TD class="confluenceTd"> <TT>null</TT> </TD>
<TD class="confluenceTd"> Selects messages of <TT>mix:language</TT> nodes ignoring the existence or absence of <TT>sling:basename</TT> properties </TD>
</TR>
<TR>
<TD class="confluenceTd"> Empty String </TD>
<TD class="confluenceTd"> Selects messages of <TT>mix:language</TT> nodes which have <TT>sling:basename</TT> properties, ignoring the actual values </TD>
</TR>
<TR>
<TD class="confluenceTd"> Any other Value </TD>
<TD class="confluenceTd"> Selects messages of <TT>mix:language</TT> nodes whose <TT>sling:basename</TT> properties has any value which matches the base name string </TD>
</TR>
</TBODY></TABLE>

<P>The <TT>sling:basename</TT> property may be multi-valued, that is the messages of a <TT>mix:language</TT> nodes may belong to multiple base names and thus <TT>ResourceBundle</TT> instances.</P>


<H3><A name="InternationalizationSupport-SampleResources"></A>Sample Resources</H3>

<P>Consider the following repository content:</P>

<DIV class="code"><DIV class="codeContent">
<PRE class="code-java">/libs/languages
           +-- English (nt:folder, mix:language)
           |    +-- jcr:language = en
           |    +-- m1 (sling:messageEntry)
           |    |    +-- sling:key = <SPAN class="code-quote">&quot;msg001&quot;</SPAN>
           |    |    +-- slign:message = <SPAN class="code-quote">&quot;This is a message&quot;</SPAN>
           |    +-- m2 (sling:messageEntry)
           |         +-- sling:key = <SPAN class="code-quote">&quot;msg002&quot;</SPAN>
           |         +-- slign:message = <SPAN class="code-quote">&quot;Another message&quot;</SPAN>
           +-- Deutsch (nt:folder, mix:language)
                +-- jcr:language = de
                +-- m1 (sling:messageEntry)
                |    +-- sling:key = <SPAN class="code-quote">&quot;msg001&quot;</SPAN>
                |    +-- slign:message = <SPAN class="code-quote">&quot;Das ist ein Text&quot;</SPAN>
                +-- m2 (sling:messageEntry)
                     +-- sling:key = <SPAN class="code-quote">&quot;msg002&quot;</SPAN>
                     +-- slign:message = <SPAN class="code-quote">&quot;Ein anderer Text&quot;</SPAN>

   /apps/myApp
           +-- English (nt:folder, mix:language)
           |    +-- jcr:language = en
           |    +-- mx (sling:messageEntry)
           |         +-- sling:key = <SPAN class="code-quote">&quot;msgXXX&quot;</SPAN>
           |         +-- slign:message = <SPAN class="code-quote">&quot;An Application Text&quot;</SPAN>
           +-- Deutsch (nt:folder, mix:language)
                +-- jcr:language = de
                +-- mx (sling:messageEntry)
                     +-- sling:key = <SPAN class="code-quote">&quot;msgXXX&quot;</SPAN>
                     +-- slign:message = <SPAN class="code-quote">&quot;Ein Anwendungstext&quot;</SPAN></PRE>
</DIV></DIV>

<P>This content defines two languages <EM>en</EM> and <EM>de</EM> with three messages <EM>msg001</EM>, <EM>msg002</EM> and <EM>msgXXX</EM> each. The names of the respective nodes have no significance at all because all information required is extracted from the <TT>jcr:language</TT>, <TT>sling:key</TT> and <TT>sling:message</TT> properties.</P>


<H3><A name="InternationalizationSupport-JCRNodeTypessupportingtheJCRRepositorybased%7B%7BResourceBundleProvider%7D%7D"></A>JCR Node Types supporting the JCR Repository based <TT>ResourceBundleProvider</TT></H3>

<P>The sling.i18n bundle asserts the following node types:</P>

<DIV class="code"><DIV class="codeHeader"><B>mix:language</B></DIV><DIV class="codeContent">
<PRE class="code-java">[mix:language]
    mixin
  - jcr:language (string)</PRE>
</DIV></DIV>

<P>The <TT>mix:language</TT> mixin node type allows setting the <TT>jcr:language</TT> property required by the <TT>ResourceBundleProvider</TT> implementation to identify the message <TT>Locale</TT>.</P>


<DIV class="code"><DIV class="codeHeader"><B>sling:Language</B></DIV><DIV class="codeContent">
<PRE class="code-java">[sling:Language]
    mixin
  - sling:basename (string)
  - sling:basename (string) multiple</PRE>
</DIV></DIV>

<P>The <TT>sling:Language</TT> mixin node type extends the <TT>jcr:language</TT> mixin node type and in addition to the language allows the specification of one more more base names to which the contained messages belong. This property is accessed by the <TT>getResourceBundle(String, Locale)</TT> methods.</P>


<DIV class="code"><DIV class="codeHeader"><B>sling:message and sling:messageEntry</B></DIV><DIV class="codeContent">
<PRE class="code-java">[sling:message]
    mixin
  - sling:key (string)
  - sling:message (undefined)

[sling:messageEntry] &gt; nt:hierarchyNode, sling:message</PRE>
</DIV></DIV>

<P>The <TT>sling:message</TT> and <TT>slign:messageEntry</TT> are helper node types which may be used to create the nodes with the <TT>sling:key</TT> and <TT>sling:message</TT> properties required by the <TT>ResourceBundleProvider</TT>. The node types themselves are not required but by defining the required properties, they may be of use.</P>
        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by fmeschbe on 2008-04-04 16:56:13.0
        </DIV>
    </DIV>
  </BODY>
</HTML>

