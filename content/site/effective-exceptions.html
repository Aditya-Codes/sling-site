
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Sling - Effective Exceptions</TITLE>
    <LINK rel="stylesheet" href="http://incubator.apache.org/sling/site/media.data/site.css" type="text/css" media="all">
    <LINK rel="icon" href="http://incubator.apache.org/sling/site/media.data/favicon.ico">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY><div class="siteconversion">This is an old version of the Sling website, see the <a href="http://sling.apache.org/site-conversion.html">site conversion page</a> for more info.</div>
    <DIV class="title">
      <DIV class="logo">
        <A href="http://incubator.apache.org/sling/site/index.html">
          <IMG border="0" alt="Apache Sling" src="http://incubator.apache.org/sling/site/media.data/logo.png">
        </A>
      </DIV>
      <DIV class="header">
        <A href="http://incubator.apache.org/">
          <IMG border="0" alt="Apache Incubator" src="http://incubator.apache.org/images/apache-incubator-logo.png">
        </A>
      </DIV>
    </DIV>
    <DIV class="menu">
                                    <P>

<UL>
	<LI><A href="index.html" title="Index">Home</A></LI>
	<LI><A href="project-information.html" title="Project Information">Project Information</A></LI>
	<LI><A href="usecases.html" title="UseCases">Use Cases</A></LI>
	<LI><A href="guides.html" title="Guides">Guides</A></LI>
	<LI><A href="documentation.html" title="Documentation">Documentation</A></LI>
	<LI><A href="plugins.html" title="Plugins">Plugins</A></LI>
	<LI><A href="faq.html" title="FAQ">FAQ</A></LI>
	<LI><A href="links.html" title="Links">Links</A></LI>
	<LI><A href="old-documentation.html" title="Old Documentation">Old Documentation</A></LI>
	<LI><SPAN class="nobr"><A href="http://cwiki.apache.org/confluence/x/GAUB" title="Visit page outside Confluence" rel="nofollow">Wiki<SUP><IMG class="rendericon" src="http://cwiki.apache.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://www.apache.org/foundation/thanks.html" title="Visit page outside Confluence" rel="nofollow">Sponsors<SUP><IMG class="rendericon" src="http://cwiki.apache.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://www.apache.org/foundation/sponsorship.html" title="Visit page outside Confluence" rel="nofollow">Sponsorship<SUP><IMG class="rendericon" src="http://cwiki.apache.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<P>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </DIV>
    <DIV class="main">
<H1><A name="EffectiveExceptions-RethinkingtheSlingException"></A>Rethinking the SlingException</H1>



<P>Status: DRAFT<BR>
Created: 23. December 2007<BR>
Author: fmeschbe</P>



<P>Inspired by Barry Ruzek's article <SPAN class="nobr"><A href="http://dev2dev.bea.com/pub/a/2006/11/effective-exceptions.html" title="Visit page outside Confluence" rel="nofollow">Effective Java Exceptions<SUP><IMG class="rendericon" src="http://cwiki.apache.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN>, I went out to revisit the exceptions we have defined in the Sling API. This is what I came out with:</P>

<UL>
	<LI>We have 4 Exceptions, all of which are checked exceptions</LI>
	<LI>The <TT>SlingException</TT> is a base exception and is declared almost everywhere</LI>
	<LI>The <TT>HttpStatusCodeException</TT> is an <TT>IOException</TT> not a <TT>SlingException</TT> and is not declared to be thrown anywhere</LI>
	<LI>We have two documented possibilities of throwing a runtime exception: The <TT>AccessControlException</TT> possibly thrown when accessing a resource through the <TT>ResourceResolver</TT>.</LI>
</UL>


<P>Thinking about these (checked) Exceptions, I propose to change the Sling API as follows:</P>

<OL>
	<LI>The <TT>SlingException</TT> is a <TT>RuntimeException</TT> and is used as the base exception for all exceptions defined by the Sling API.</LI>
	<LI>The <TT>HttpStatusCodeException</TT> is removed. Status codes are better reported back to the client using <TT>HttpServletResponse.sendError()</TT>.</LI>
	<LI>Add <TT>ResourceNotFoundException</TT> which may be used by scripts and servlets to report a missing resource.</LI>
	<LI>Add <TT>QuerySyntaxException</TT> thrown from the <TT>ReourceResolver.findResources</TT> and <TT>ResourceResolver.queryResources</TT> methods.</LI>
	<LI>Add <TT>ScriptEvaluationException</TT> thrown by <TT>SlingScript.eval</TT> wrapping and further failure cause.</LI>
	<LI>Drop <TT>ServiceNotAvailableException</TT> and the respective <TT>ServiceLocator.getRequiredService</TT>: The method and thus the exception are probably not very usefull. Rather the <TT>ServiceLocator.getService</TT> method should be used and the result checked for <TT>null</TT>.</LI>
	<LI>Add <TT>SlingIOException</TT> and <TT>SlingServletException</TT> both extending <TT>SlingException</TT>. These exceptions are used to wrap <TT>IOException</TT> and <TT>ServletException</TT> instances to be able to forward them as runtime exceptions to the appropriate error handling.</LI>
</OL>


<P>This change also has an influence on the implementation of the Sling API:</P>

<OL>
	<LI>The main point is the handling of the <TT>SlingException</TT> in the Sling main servlet.</LI>
	<LI>Other locations catching <TT>Exception</TT> should be revisited to make sure no <TT>SlingException</TT> is swallowed and not treated correctly.</LI>
</OL>


<P>Another point with the Sling main servlet is, that it is important to not call error handling servlets from included requests but only from the topmost request.</P>

<P>The proposed API changes can be evaluated in the Sling whiteboard at <SPAN class="nobr"><A href="http://svn.apache.org/repos/asf/incubator/sling/whiteboard/fmeschbe/effective_exceptions" title="Visit page outside Confluence" rel="nofollow">http://svn.apache.org/repos/asf/incubator/sling/whiteboard/fmeschbe/effective_exceptions<SUP><IMG class="rendericon" src="http://cwiki.apache.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></P>
    </DIV>
  </BODY>
</HTML>

