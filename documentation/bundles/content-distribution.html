<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html lang="en">
<head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
        <title>Apache Sling :: Content Distribution (org.apache.sling.distribution)</title>
        <link rel="icon" href="/ng/res/favicon.ico"/>
        <link rel="stylesheet" href="/ng/res/css/site.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script><script>
            hljs.initHighlightingOnLoad();
        </script>
        
    </head>    <body>
<div class="title">
            <div class="logo">
                <a href="http://sling.apache.org">
                    <img border="0" alt="Apache Sling" src="/ng/res/logos/sling.svg"/>
                </a>
            </div><div class="header">
                <a href="http://www.apache.org">
                    <img border="0" alt="Apache" src="/ng/res/logos/apache.png"/>
                </a>
            </div>
        </div><h1 class="draft">DRAFT 2017 WEBSITE - SLING-6955</h1><div class="menu">
            <p>
                <strong><a href="/ng/documentation.html">Documentation</a></strong><br/>
                <a href="/ng/documentation/getting-started.html">Getting Started</a><br/>
                <a href="/ng/documentation/the-sling-engine.html">The Sling Engine</a><br/>
                <a href="/ng/documentation/development.html">Development</a><br/>
                <a href="/ng/documentation/bundles.html">Bundles</a><br/>
                <a href="/ng/documentation/tutorials-how-tos.html">Tutorials &amp; How-Tos</a><br/>
                <a href="/ng/documentation/configuration.html">Configuration</a>
            </p><p>
                <a href="http://s.apache.org/sling.wiki">Wiki</a><br/>
                <a href="http://s.apache.org/sling.faq">FAQ</a><br/>
                
            </p><p>
                <strong>API Docs</strong><br/>
                <a href="/ng/apidocs/sling9/index.html">Sling 9</a><br/>
                <a href="/ng/apidocs/sling8/index.html">Sling 8</a><br/>
                <a href="/ng/apidocs/sling7/index.html">Sling 7</a><br/>
                <a href="/ng/apidocs/sling6/index.html">Sling 6</a><br/>
                <a href="/ng/apidocs/sling5/index.html">Sling 5</a><br/>
                <a href="/ng/javadoc-io.html">Archive at javadoc.io</a><br/>
                
            </p><p>
                <strong>Project info</strong><br/>
                <a href="/ng/downloads.cgi">Downloads</a><br/>
                <a href="http://www.apache.org/licenses/">License</a><br/>
                <a href="/ng/contributing.html">Contributing</a><br/>
                <a href="/ng/news.html">News</a><br/>
                <a href="/ng/links.html">Links</a><br/>
                <a href="/ng/project-information.html">Project Information</a><br/>
                <a href="https://issues.apache.org/jira/browse/SLING">Issue Tracker</a><br/>
                <a href="/ng/project-information/security.html">Security</a><br/>
                
            </p><p>
                <strong>Source</strong><br/>
                <a href="http://svn.apache.org/viewvc/sling/trunk">Subversion</a><br/>
                <a href="git://git.apache.org/sling.git">Git</a><br/>
                <a href="https://github.com/apache/sling">Github Mirror</a><br/>
                
            </p><p>
                <strong>Sponsorship</strong><br/>
                <a href="http://www.apache.org/foundation/thanks.html">Thanks</a><br/>
                <a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a><br/>
                <a href="https://donate.apache.org/">Donate!</a><br/>
                <a href="http://www.apache.org/foundation/buy_stuff.html">Buy Stuff</a><br/>
                
            </p><p>
                <strong><a href="/ng/sitemap.html">Site Map</a></strong>
            </p>
        </div>        <div class="main">
<div class="breadcrumbs"><a href="/ng/">Home</a>&nbsp;&raquo;&nbsp;<a href="/ng/documentation.html">Documentation</a>&nbsp;&raquo;&nbsp;<a href="/ng/documentation/bundles.html">Bundles</a>&nbsp;&raquo;&nbsp;</div>            <h1>
                Content Distribution (org.apache.sling.distribution)
            </h1><div class="row"><div class="small-12 columns"><section class="wrap"><p><!-- TODO reactivate TOC once JBake moves to flexmark-java -->
</p>
<h2><a href="#introduction" name="introduction">Introduction</a></h2>
<p>The Sling Content Distribution (SCD) module allows one to distribute Sling resources between different Sling instances. The API works at path level and the distribution agents basically enable distribution of specific paths between instances. There are several main usecases in which SCD can help. Typically the distribution is done from one or more source instances to one or more target instances.</p>
<h2><a href="#distribution-usecases" name="distribution-usecases">Distribution usecases</a></h2>
<p>Some of the usecases have sample configuration in <a href="https://github.com/apache/sling/tree/trunk/contrib/extensions/distribution/sample/src/main/resources/SLING-CONTENT/libs/sling/distribution">Distribution Sample Module</a> and are tested in <a href="https://github.com/apache/sling/tree/trunk/contrib/extensions/distribution/it">Distribution ITs Module</a>.</p>
<h3><a href="#forward-distribution" name="forward-distribution">Forward distribution</a></h3>
<p>A forward distribution setup allows one to transfer content from a source instance to a farm of target instances. That is done by pushing the content from source to target.</p>
<h4><a href="#setup-overview" name="setup-overview">Setup overview</a></h4>
<ul>
  <li>one source instance
    <ul>
      <li>one distribution agent connected to importer endpoints for all target instances.</li>
    </ul>
  </li>
  <li>N target instances
    <ul>
      <li>one distribution importer on each target instance used to import packages into the local instance.</li>
    </ul>
  </li>
</ul>
<h4><a href="#sample-configuration" name="sample-configuration">Sample configuration</a></h4>
<ul>
  <li>
    <p>on source instance: one forward agent</p>
    <pre><code>org.apache.sling.distribution.agent.impl.ForwardDistributionAgentFactory-publish.json            
    name=&quot;publish&quot;
    packageImporter.endpoints=[&quot;http://localhost:4503/libs/sling/distribution/services/importers/default&quot;]
</code></pre>
  </li>
  <li>
    <p>on target instance: one local importer</p>
    <pre><code>org.apache.sling.distribution.packaging.impl.importer.LocalDistributionPackageImporterFactory-default
    name=&quot;default&quot;
</code></pre>
  </li>
</ul>
<h3><a href="#reverse-distribution" name="reverse-distribution">Reverse distribution</a></h3>
<p>A reverse distribution setup allows one to transfer content from a farm of source instances to a target instance. That is done by pulling the content from source instances into the target instance.</p>
<h4><a href="#setup-overview" name="setup-overview">Setup overview</a></h4>
<ul>
  <li>one target instance
    <ul>
      <li>one distribution agent connected to exporter endpoints for all target instances.</li>
    </ul>
  </li>
  <li>N source instances
    <ul>
      <li>one distribution (queue) agent on each source instance; changes from the source instances are placed in the queues of these agents.</li>
      <li>one distribution exporter on each source instance that exports packages from the queue agent.</li>
    </ul>
  </li>
</ul>
<h4><a href="#sample-configuration" name="sample-configuration">Sample configuration</a></h4>
<ul>
  <li>
    <p>on target instance: one reverse agent</p>
    <pre><code>org.apache.sling.distribution.agent.impl.ReverseDistributionAgentFactory-reverse.json            
    name=&quot;reverse&quot;
    packageExporter.endpoints=[&quot;http://localhost:4503/libs/sling/distribution/services/exporters/reverse&quot;]
</code></pre>
  </li>
  <li>
    <p>on source instance: one queue agent and one exporter for that agent</p>
    <pre><code>org.apache.sling.distribution.agent.impl.QueueDistributionAgentFactory-reverse.json            
    name=&quot;reverse&quot;

org.apache.sling.distribution.packaging.impl.exporter.AgentDistributionPackageExporterFactory-reverse
    name=&quot;reverse&quot;
    agent.target=&quot;(name=reverse)&quot;
</code></pre>
  </li>
</ul>
<h3><a href="#sync-distribution" name="sync-distribution">Sync distribution</a></h3>
<p>A sync distribution setup allows one to synchronize content in a farm of instances. That is done by using a coordinator instance (typically an author instance) that pulls content from all instances in a farm and pushes it back to all.</p>
<h4><a href="#setup-overview-" name="setup-overview-">Setup overview:</a></h4>
<ul>
  <li>one coordinator instance
    <ul>
      <li>one distribution agent connected to exporter/importer endpoints for all farm instances.</li>
    </ul>
  </li>
  <li>N farm instances
    <ul>
      <li>one distribution (queue) agent on each farm instance; changes from these instances are placed in the queues of the queue agents.</li>
      <li>one distribution exporter on each farm instance that exports packages from the queue agent.</li>
      <li>one distribution importer on each farm instance used to import packages into the local instance.</li>
    </ul>
  </li>
</ul>
<h4><a href="#sample-configuration" name="sample-configuration">Sample configuration</a></h4>
<ul>
  <li>
    <p>on coordinator instance: one sync agent</p>
    <pre><code>org.apache.sling.distribution.agent.impl.SyncDistributionAgentFactory-sync.json            
    name=&quot;sync&quot;
    packageExporter.endpoints=[&quot;http://localhost:4503/libs/sling/distribution/services/exporters/reverse&quot;, &quot;http://localhost:4504/libs/sling/distribution/services/exporters/reverse&quot;]
    packageImporter.endpoints=[&quot;http://localhost:4503/libs/sling/distribution/services/importers/default&quot;, &quot;http://localhost:4504/libs/sling/distribution/services/importers/default&quot;]
</code></pre>
  </li>
  <li>
    <p>on each farm instance: one local exporter and one local importer</p>
    <pre><code>org.apache.sling.distribution.agent.impl.QueueDistributionAgentFactory-reverse.json            
    name=&quot;reverse&quot;

org.apache.sling.distribution.packaging.impl.exporter.AgentDistributionPackageExporterFactory-reverse
    name=&quot;reverse&quot;
    agent.target=&quot;(name=reverse)&quot;

org.apache.sling.distribution.packaging.impl.importer.LocalDistributionPackageImporterFactory-default
    name=&quot;reverse&quot;
    agent.target=&quot;(name=reverse)&quot;
</code></pre>
  </li>
</ul>
<h3><a href="#multidatacenter-sync-distribution" name="multidatacenter-sync-distribution">Multidatacenter sync distribution</a></h3>
<p>A multidatacenter sync distribution setup allows one to synchronize content in a farm of publish instances across datacenters. This a variation of sync distribution but using a coordinator in each datacenter.</p>
<h4><a href="#setup-overview" name="setup-overview">Setup overview</a></h4>
<ul>
  <li>one coordinator instance in each datacenter
    <ul>
      <li>one distribution agent for intra-datacenter synchronization. Like a regular sync agent it connects to all farm instances in its datacenter and syncronizes them. In addition to a regular sync agent it keeps the packages also in dedicated queues for the other DCs, so that the coordinators from the other DCs can pull the updates.</li>
      <li>one distribution exporter for each queue dedicated for the remote DCs. The inter-dc coordinators from the other DCs will connect to these exporter endpoints.</li>
      <li>one distribution agent for inter-datacenter synchronization; it conntects to the dedicated queues exposed by intra-dc coordinators from the other datacenters.</li>
    </ul>
  </li>
  <li>N farm instances in each datacenter
    <ul>
      <li>one distribution (queue) agent on each farm instance; changes from these instances are placed in the queues of the queue agents.</li>
      <li>one distribution exporter on each farm instance that exports packages from the queue agent.</li>
      <li>one distribution importer on each farm instance used to import packages into the local instance.</li>
    </ul>
  </li>
</ul>
<h4><a href="#sample-configuration" name="sample-configuration">Sample configuration</a></h4>
<ul>
  <li>
    <p>on coordinator instance: one intradcsync agent with two exporters for the other dcs, and one interdcsync agent that connects to remote exporters.</p>
    <pre><code>org.apache.sling.distribution.agent.impl.SyncDistributionAgentFactory-intradcsync          
    name=&quot;intradcsync&quot;
    packageExporter.endpoints=[&quot;http://localhost:4503/libs/sling/distribution/services/exporters/reverse&quot;, &quot;http://localhost:4504/libs/sling/distribution/services/exporters/reverse&quot;]
    packageImporter.endpoints=[&quot;http://localhost:4503/libs/sling/distribution/services/importers/default&quot;, &quot;http://localhost:4504/libs/sling/distribution/services/importers/default&quot;]
    passiveQueues=[&quot;dc2queue&quot;, &quot;dc3queue&quot;]

org.apache.sling.distribution.packaging.impl.exporter.AgentDistributionPackageExporterFactory-dc2queue
    name=&quot;dc2queue&quot;
    agent.target=&quot;(name=intradcsync)&quot;
    queue=&quot;dc2queue&quot;

org.apache.sling.distribution.packaging.impl.exporter.AgentDistributionPackageExporterFactory-dc3queue
    name=&quot;dc3queue&quot;
    agent.target=&quot;(name=intradcsync)&quot;
    queue=&quot;dc3queue&quot;

org.apache.sling.distribution.agent.impl.SyncDistributionAgentFactory-interdcsync           
    name=&quot;interdcsync&quot;
    packageExporter.endpoints=[&quot;http://localhost:5502/libs/sling/distribution/services/exporters/dc1queue&quot;, &quot;http://localhost:6502/libs/sling/distribution/services/exporters/dc1queue&quot;]
    packageImporter.endpoints=[&quot;http://localhost:4503/libs/sling/distribution/services/importers/default&quot;, &quot;http://localhost:4504/libs/sling/distribution/services/importers/default&quot;]
</code></pre>
  </li>
  <li>
    <p>on each farm instance: one local exporter and one local importer</p>
    <pre><code>org.apache.sling.distribution.agent.impl.QueueDistributionAgentFactory-reverse.json            
    name=&quot;reverse&quot;

org.apache.sling.distribution.packaging.impl.exporter.AgentDistributionPackageExporterFactory-reverse
    name=&quot;reverse&quot;
    agent.target=&quot;(name=reverse)&quot;

org.apache.sling.distribution.packaging.impl.importer.LocalDistributionPackageImporterFactory-default
    name=&quot;default&quot;
</code></pre>
  </li>
</ul>
<h2><a href="#additional-options" name="additional-options">Additional options</a></h2>
<h3><a href="#how-to-trigger-distribution-over-http-" name="how-to-trigger-distribution-over-http-">How to trigger distribution over HTTP?</a></h3>
<h3><a href="#how-to-configure-binary-less-distribution-" name="how-to-configure-binary-less-distribution-">How to configure binary-less distribution?</a></h3>
<h3><a href="#how-to-configure-priority-paths-" name="how-to-configure-priority-paths-">How to configure priority paths?</a></h3>
<h3><a href="#how-to-configure-error-queues-" name="how-to-configure-error-queues-">How to configure error queues?</a></h3></section></div></div>
<div class="footer">
                <div class="trademarkFooter">
                    Apache Sling, Sling, Apache, the Apache feather logo, and the Apache Sling project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
                </div>
            </div>            
            
        </div>
    </body>
</html>
